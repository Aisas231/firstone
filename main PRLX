<section id="gtpx-hero">
  <div class="gtpx-wrap">
    <video class="gtpx-video" autoplay loop muted playsinline preload="auto"
           poster="https://static.tildacdn.com/tilda-hero/poster.jpg">
      <source src="https://static.tildacdn.com/vide3230-3663-4135-a333-323733373231/Sequence_01-1440p_1.mp4" type="video/mp4">
    </video>

    <!-- Кнопки поверх видео -->
    <nav class="gtpx-overlay" aria-label="Основные разделы">
      <a href="#catalog" class="gtpx-btn">Каталог</a>
      <a href="#about"   class="gtpx-btn">О нас</a>
      <a href="#faq"     class="gtpx-btn">FAQ</a>
    </nav>
  </div>

  <!-- PRLX стеклянная подпложка -->
  <button class="gtpx-prlx" type="button" aria-pressed="false" hidden>PRLX</button>
</section>

<style>
  :root{
    --gtpx-gx: 0px;

    /* позиция кнопок */
    --btn-top-d: 60.5%;   --btn-left-d: 50%;
    --btn-top-m: 62%;     --btn-left-m: 49%;

    /* размеры */
    --btn-width-d: 160px;  --btn-width-m: 130px;
    --btn-gap-d: 17px;     --btn-gap-m: 12px;
  }

  /* HERO */
  #gtpx-hero{
    position:relative; width:100%; height:100svh;
    overflow:hidden; background:#FDF5CE;
    touch-action: pan-y; contain: layout style paint;
    margin-bottom:-1px;
  }
  #gtpx-hero .gtpx-wrap{
    position:absolute; inset:0; width:100%; height:100%;
    transform: translateX(var(--gtpx-gx)); will-change:transform;
  }
  #gtpx-hero .gtpx-video{
    width:100%; height:100%; object-fit:cover; object-position:50% 60%;
    display:block; background:transparent;
  }

  /* Tilda Zero-Block fix */
  .t-rec:has(#gtpx-hero) .t396__artboard,
  .t-rec:has(#gtpx-hero) .t396__carrier,
  .t-rec:has(#gtpx-hero) .t396__filter{ height:100svh !important; }
  .t-rec:has(#gtpx-hero){ padding-top:0 !important; padding-bottom:0 !important; }

  /* ===== Кнопки ===== */
  #gtpx-hero .gtpx-overlay{
    position:absolute; top:var(--btn-top-d); left:var(--btn-left-d);
    transform:translate(-50%,-50%);
    display:flex; flex-direction:column; align-items:center;
    gap:var(--btn-gap-d); z-index:10;
  }
  #gtpx-hero .gtpx-btn{
    --edge: #FFDFAE;                /* тёплый янтарный контур */
    --glow: rgba(255, 200, 120, .65);
    --fill: rgba(246, 217, 133, 0.12);

    position:relative;
    width:var(--btn-width-d);
    display:flex; align-items:center; justify-content:center;
    padding:9px 20px;
    border-radius:999px;
    background:var(--fill);
    border:2px solid var(--edge);
    color:#101010; text-decoration:none;
    font:700 16px/1.2 'Montserrat', system-ui, sans-serif;
    letter-spacing:.01em;

    /* контур + мягкое свечение */
    box-shadow:
      inset 0 0 6px rgba(255, 230, 180, .35),
      0 0 10px var(--edge),
      0 0 22px var(--glow);
    transition: all .25s ease;
  }
  #gtpx-hero .gtpx-btn::before{
    content:""; position:absolute; inset:3px; border-radius:inherit;
    background: radial-gradient(100% 120% at 50% 50%,
                rgba(255, 240, 200, .25) 0%,
                rgba(255, 240, 200, .1) 40%,
                rgba(255, 240, 200, 0) 70%);
    pointer-events:none;
  }
  #gtpx-hero .gtpx-btn::after{
    content:""; position:absolute; inset:-12px; border-radius:inherit; z-index:-1;
    background: radial-gradient(70% 90% at 50% 50%,
                rgba(255, 223, 174, .85) 0%,
                rgba(255, 200, 120, .45) 40%,
                rgba(255, 200, 120, .1) 65%,
                rgba(255, 200, 120, 0) 80%);
    filter: blur(8px); opacity:.6; pointer-events:none;
    transition: opacity .25s ease, filter .25s ease;
  }
  #gtpx-hero .gtpx-btn:hover{
    background:rgba(255, 248, 235, .15);
    box-shadow:
      inset 0 0 10px rgba(255, 240, 200, .55),
      0 0 14px var(--edge),
      0 0 30px var(--glow),
      0 6px 14px rgba(0,0,0,.14);
    transform:translateY(-1px);
  }
  #gtpx-hero .gtpx-btn:hover::after{ opacity:.9; filter:blur(12px); }

  /* Mobile */
  @media (max-width: 960px){
    #gtpx-hero .gtpx-wrap{ width:118%; left:-9%; }
    #gtpx-hero .gtpx-video{ object-position:51% 56%; }
    #gtpx-hero .gtpx-overlay{ top:var(--btn-top-m); left:var(--btn-left-m); gap:var(--btn-gap-m); }
    #gtpx-hero .gtpx-btn{ width:var(--btn-width-m); font-size:15px; padding:8px 16px; }
  }

  /* PRLX стеклянная подпложка */
  #gtpx-hero .gtpx-prlx{
    position:absolute; right:12px; bottom:12px; z-index:11;
    padding:8px 14px; border:1px solid rgba(255,255,255,.35);
    border-radius:999px; background:rgba(255,255,255,.12);
    color:#EDEADE; font:700 14px/1 system-ui,-apple-system,Montserrat,Arial;
    letter-spacing:.12em; cursor:pointer; user-select:none;
    backdrop-filter: blur(8px) saturate(140%);
    -webkit-backdrop-filter: blur(8px) saturate(140%);
    box-shadow: 0 6px 18px rgba(0,0,0,.18), inset 0 0 0 1px rgba(255,255,255,.2);
    transition:all .2s ease;
  }
  #gtpx-hero .gtpx-prlx:hover{
    background:rgba(255,255,255,.18); border-color:rgba(255,255,255,.5);
    box-shadow: 0 10px 28px rgba(0,0,0,.22), inset 0 0 0 1px rgba(255,255,255,.28);
    transform: translateY(-1px);
  }
  #gtpx-hero .gtpx-prlx[aria-pressed="true"]{ color:#FDF5CE; text-shadow:0 0 10px rgba(253,245,206,.5); }
  @media (min-width: 961px){ #gtpx-hero .gtpx-prlx{ display:none; } }
</style>

<script>
(() => {
  const hero = document.getElementById('gtpx-hero');
  const wrap = hero.querySelector('.gtpx-wrap');
  const video = hero.querySelector('.gtpx-video');
  const prlx  = hero.querySelector('.gtpx-prlx');
  const rec   = hero.closest('.t-rec');
  const art   = rec ? rec.querySelector('.t396__artboard') : null;
  const car   = rec ? rec.querySelector('.t396__carrier')  : null;
  const fil   = rec ? rec.querySelector('.t396__filter')   : null;
  const isMobile = () => matchMedia('(max-width: 960px)').matches;

  /* Автоплей */
  const kick = () => { if(video && video.paused){ video.play().catch(()=>{}); } };
  document.addEventListener('touchstart', kick, {once:true, passive:true});
  document.addEventListener('click',      kick, {once:true});

  /* фикс высоты */
  function applyTrueVHOnce(){
    const H = Math.round(window.visualViewport?.height || window.innerHeight);
    [hero, wrap, video, art, car, fil].forEach(el => el && (el.style.height = H + 'px'));
    if(rec){ rec.style.paddingTop='0px'; rec.style.paddingBottom='0px'; }
  }
  applyTrueVHOnce();
  window.addEventListener('orientationchange', () => setTimeout(applyTrueVHOnce, 120));
  window.addEventListener('pageshow', applyTrueVHOnce);

  /* PRLX на мобиле */
  const togglePRLX = () => { prlx.hidden = !isMobile(); };
  togglePRLX(); window.addEventListener('resize', togglePRLX);

  /* Плавный параллакс */
  let targetX = 0, currentX = 0;
  (function loop(){
    currentX += (targetX - currentX) * 0.12;
    wrap.style.setProperty('--gtpx-gx', currentX.toFixed(2)+'px');
    requestAnimationFrame(loop);
  })();
  const maxShift = () => Math.max(0, (wrap.offsetWidth - hero.offsetWidth)/2);

  /* Гиропараллакс */
  let gyroOn = false, bound = false;
  async function requestGyroPermission(){
    if (typeof DeviceOrientationEvent !== 'undefined'
        && typeof DeviceOrientationEvent.requestPermission === 'function') {
      try{ return (await DeviceOrientationEvent.requestPermission()) === 'granted'; }
      catch{ return false; }
    }
    return true;
  }
  function bindGyro(){
    if(bound) return; bound = true;
    window.addEventListener('deviceorientation', (e)=>{
      if(!gyroOn || !isMobile()) return;
      let g = e.gamma ?? 0; g = Math.max(-45, Math.min(45, g));
      targetX = (-g/45) * maxShift();
    }, true);
  }
  async function enableGyro(){
    if(!isMobile()) return;
    const ok = await requestGyroPermission();
    gyroOn = ok; prlx.setAttribute('aria-pressed', ok ? 'true' : 'false');
    if(ok) bindGyro(); else targetX = 0;
  }
  if(isMobile()){
    enableGyro();
    window.addEventListener('touchend', function once(){
      if(!gyroOn) enableGyro();
      window.removeEventListener('touchend', once);
    }, {passive:true});
  }
  prlx.addEventListener('click', async ()=>{
    if(!gyroOn) await enableGyro();
    else { gyroOn=false; prlx.setAttribute('aria-pressed','false'); targetX=0; }
  });

  /* drag fallback */
  let dragging=false, startX=0, baseX=0;
  hero.addEventListener('touchstart',(e)=>{
    if(!isMobile() || gyroOn) return; dragging=true; startX=e.touches[0].clientX;
  }, {passive:true});
  hero.addEventListener('touchmove',(e)=>{
    if(!dragging || !isMobile() || gyroOn) return;
    const dx = e.touches[0].clientX - startX;
    const m = maxShift();
    targetX = Math.max(-m, Math.min(m, baseX + dx));
  }, {passive:true});
  hero.addEventListener('touchend',()=>{
    if(!isMobile() || gyroOn) return; dragging=false; baseX = targetX;
  }, {passive:true});
})();
</script>
